<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="-20 -460 1130 1038" width="1130" height="1038">
<metadata><diagramflow:source xmlns:diagramflow="https://diagramflow.vscode/schema">{"meta":{"version":"1.0","title":"DiagramFlow Architecture","created":"2025-01-01T00:00:00Z","modified":"2026-02-23T20:11:18.263Z"},"nodes":[{"id":"n1","label":"extension.ts","shape":"rounded","color":"blue","x":420,"y":-420,"width":160,"height":48,"pinned":true,"group":"g1","notes":"Extension entry. Activates on onCustomEditor. Registers DiagramEditorProvider, LM tools, and commands (newDiagram, sortNodes, autoLayout, undo, redo)."},{"id":"n2","label":"DiagramEditorProvider","shape":"rounded","color":"blue","x":670,"y":-420,"width":200,"height":48,"pinned":true,"group":"g1","notes":"Custom text editor provider. Manages webview lifecycle, routes messages to DiagramService, VIEW_METADATA shows formatted JSON doc."},{"id":"n3","label":"DiagramService","shape":"rounded","color":"blue","x":910,"y":-420,"width":160,"height":48,"pinned":true,"group":"g1","notes":"Core state manager. Parses/serialises .diagram.svg, manages undo/redo history, drives sortNodes and autoLayout."},{"id":"n4","label":"LM Tools","shape":"rounded","color":"purple","x":340,"y":-280,"width":130,"height":48,"pinned":true,"group":"g1","notes":"Copilot LM tools: readDiagram, getDiagram, addNodes, addEdges, updateNodes, updateEdges, removeNodes, removeEdges, addGroups, updateGroups, removeGroups."},{"id":"n5","label":"lib/","shape":"cylinder","color":"default","x":910,"y":-330,"width":160,"height":48,"pinned":true,"group":"g1","notes":"Shared libraries: exporters (buildDocumentSvg, buildMermaid), svgMetadata (parse/unescape), layoutEngine (dagre), operations (CRUD), agentContext (LLM metadata)."},{"id":"n10","label":".diagram.svg","shape":"cylinder","color":"gray","x":830,"y":140,"width":140,"height":48,"pinned":true,"group":"g3","notes":"SVG file with diagram JSON embedded in diagramflow:source inside metadata. Viewable as SVG in any editor, editable via DiagramFlow."},{"id":"n6","label":"useGraphState","shape":"rounded","color":"green","x":60,"y":340,"width":160,"height":48,"pinned":true,"group":"g2","notes":"Bridge hook. Manages ReactFlow state. Sends postMessage to extension host. Handles incoming commands (sort, autoLayout, add, delete, etc.)."},{"id":"n7","label":"CanvasPanel","shape":"rounded","color":"green","x":260,"y":340,"width":140,"height":48,"pinned":true,"group":"g2","notes":"Main canvas. Wraps ReactFlow. Handles node/edge drag, selection, zoom/pan. Renders all node and edge types."},{"id":"n8","label":"Toolbar","shape":"rounded","color":"green","x":440,"y":340,"width":120,"height":48,"pinned":true,"group":"g2","notes":"Top toolbar. Buttons: Add, Sort, Auto Layout, Export, Metadata. Calls useGraphState handlers."},{"id":"n9","label":"DiagramGroupNode","shape":"rounded","color":"green","x":600,"y":340,"width":180,"height":48,"pinned":true,"group":"g2","notes":"Group container node. Single-click on header label to collapse/expand group members."},{"id":"n11","label":"User","shape":"rounded","color":"yellow","x":60,"y":490,"width":100,"height":48,"pinned":true},{"id":"n12","label":"GitHub Copilot","shape":"rounded","color":"purple","x":20,"y":-340,"width":160,"height":48,"pinned":true},{"id":"Vl65n_h0","label":"TasksEditorProvider","x":480,"y":-300,"width":160,"height":48,"shape":"rounded","color":"blue","pinned":false,"group":"g1"},{"id":"Wc4DO0XO","label":"TasksApp","x":300,"y":60,"width":160,"height":48,"shape":"rounded","color":"green","pinned":false,"group":"g2"},{"id":"_JYPhh4n","label":".tasks.md","x":540,"y":60,"width":160,"height":48,"shape":"cylinder","color":"gray","pinned":false,"group":"g3"}],"edges":[{"id":"e1","source":"n1","target":"n2","label":"registers","style":"solid","arrow":"arrow","animated":false},{"id":"e2","source":"n1","target":"n3","label":"creates","style":"solid","arrow":"arrow","animated":false},{"id":"e3","source":"n1","target":"n4","label":"registers","style":"solid","arrow":"arrow","animated":false},{"id":"e4","source":"n2","target":"n3","label":"uses","style":"solid","arrow":"arrow","animated":false},{"id":"e5","source":"n3","target":"n5","label":"uses","style":"solid","arrow":"arrow","animated":false},{"id":"e6","source":"n3","target":"n10","label":"reads/writes","style":"dashed","arrow":"arrow","animated":false},{"id":"e7","source":"n4","target":"n3","label":"invokes","style":"solid","arrow":"arrow","animated":false},{"id":"e8","source":"n12","target":"n4","label":"invokes tools","style":"dashed","arrow":"open","animated":true},{"id":"e9","source":"n2","target":"n6","label":"renders webview","style":"solid","arrow":"arrow","animated":false},{"id":"e10","source":"n6","target":"n2","label":"postMessage","style":"dashed","arrow":"arrow","animated":true},{"id":"e11","source":"n8","target":"n6","label":"triggers","style":"solid","arrow":"arrow","animated":false},{"id":"e12","source":"n7","target":"n6","label":"uses","style":"solid","arrow":"arrow","animated":false},{"id":"e13","source":"n11","target":"n8","label":"interacts","style":"solid","arrow":"open","animated":false},{"id":"e14","source":"n9","target":"n6","label":"collapse/expand cb","style":"solid","arrow":"arrow","animated":false},{"id":"kmDhTM8w","source":"n1","target":"Vl65n_h0","label":"registers","style":"solid","arrow":"arrow"},{"id":"h7wPWZct","source":"Vl65n_h0","target":"Wc4DO0XO","label":"renders webview","style":"solid","arrow":"arrow"},{"id":"PvV-iLZ0","source":"Wc4DO0XO","target":"Vl65n_h0","label":"postMessage","style":"dashed","arrow":"arrow"},{"id":"sxI26fLn","source":"Vl65n_h0","target":"n5","label":"uses","style":"solid","arrow":"arrow"},{"id":"Taw5c0Sf","source":"Vl65n_h0","target":"_JYPhh4n","label":"reads/writes","style":"dashed","arrow":"arrow"},{"id":"YlJi1G0R","source":"n4","target":"_JYPhh4n","label":"reads/writes","style":"dashed","arrow":"arrow"},{"id":"p6JcPyaR","source":"n11","target":"Wc4DO0XO","label":"interacts","style":"solid","arrow":"arrow"}],"groups":[{"id":"g1","label":"Extension Host","color":"blue","collapsed":false},{"id":"g2","label":"Webview / React","color":"green","x":30,"y":300,"collapsed":false},{"id":"g3","label":"File System","color":"gray","x":800,"y":100,"collapsed":false}],"viewport":{"x":0,"y":0,"zoom":1},"agentContext":{"format":"diagramflow-v1","generatedAt":"2026-02-23T20:11:18.264Z","summary":"\"DiagramFlow Architecture\" contains 15 nodes (\"extension.ts\", \"DiagramEditorProvider\", \"DiagramService\", \"LM Tools\", \"lib/\" and 10 more) connected by 21 edges. Grouped into: \"Extension Host\" (6 nodes), \"Webview / React\" (5 nodes), \"File System\" (2 nodes).","nodeIndex":[{"id":"n1","label":"extension.ts","notes":"Extension entry. Activates on onCustomEditor. Registers DiagramEditorProvider, LM tools, and commands (newDiagram, sortNodes, autoLayout, undo, redo).","group":"g1"},{"id":"n2","label":"DiagramEditorProvider","notes":"Custom text editor provider. Manages webview lifecycle, routes messages to DiagramService, VIEW_METADATA shows formatted JSON doc.","group":"g1"},{"id":"n3","label":"DiagramService","notes":"Core state manager. Parses/serialises .diagram.svg, manages undo/redo history, drives sortNodes and autoLayout.","group":"g1"},{"id":"n4","label":"LM Tools","notes":"Copilot LM tools: readDiagram, getDiagram, addNodes, addEdges, updateNodes, updateEdges, removeNodes, removeEdges, addGroups, updateGroups, removeGroups.","group":"g1"},{"id":"n5","label":"lib/","notes":"Shared libraries: exporters (buildDocumentSvg, buildMermaid), svgMetadata (parse/unescape), layoutEngine (dagre), operations (CRUD), agentContext (LLM metadata).","group":"g1"},{"id":"n10","label":".diagram.svg","notes":"SVG file with diagram JSON embedded in diagramflow:source inside metadata. Viewable as SVG in any editor, editable via DiagramFlow.","group":"g3"},{"id":"n6","label":"useGraphState","notes":"Bridge hook. Manages ReactFlow state. Sends postMessage to extension host. Handles incoming commands (sort, autoLayout, add, delete, etc.).","group":"g2"},{"id":"n7","label":"CanvasPanel","notes":"Main canvas. Wraps ReactFlow. Handles node/edge drag, selection, zoom/pan. Renders all node and edge types.","group":"g2"},{"id":"n8","label":"Toolbar","notes":"Top toolbar. Buttons: Add, Sort, Auto Layout, Export, Metadata. Calls useGraphState handlers.","group":"g2"},{"id":"n9","label":"DiagramGroupNode","notes":"Group container node. Single-click on header label to collapse/expand group members.","group":"g2"},{"id":"n11","label":"User"},{"id":"n12","label":"GitHub Copilot"},{"id":"Vl65n_h0","label":"TasksEditorProvider","group":"g1"},{"id":"Wc4DO0XO","label":"TasksApp","group":"g2"},{"id":"_JYPhh4n","label":".tasks.md","group":"g3"}],"edgeIndex":[{"from":"extension.ts","to":"DiagramEditorProvider","label":"registers"},{"from":"extension.ts","to":"DiagramService","label":"creates"},{"from":"extension.ts","to":"LM Tools","label":"registers"},{"from":"DiagramEditorProvider","to":"DiagramService","label":"uses"},{"from":"DiagramService","to":"lib/","label":"uses"},{"from":"DiagramService","to":".diagram.svg","label":"reads/writes","style":"dashed"},{"from":"LM Tools","to":"DiagramService","label":"invokes"},{"from":"GitHub Copilot","to":"LM Tools","label":"invokes tools","style":"dashed"},{"from":"DiagramEditorProvider","to":"useGraphState","label":"renders webview"},{"from":"useGraphState","to":"DiagramEditorProvider","label":"postMessage","style":"dashed"},{"from":"Toolbar","to":"useGraphState","label":"triggers"},{"from":"CanvasPanel","to":"useGraphState","label":"uses"},{"from":"User","to":"Toolbar","label":"interacts"},{"from":"DiagramGroupNode","to":"useGraphState","label":"collapse/expand cb"},{"from":"extension.ts","to":"TasksEditorProvider","label":"registers"},{"from":"TasksEditorProvider","to":"TasksApp","label":"renders webview"},{"from":"TasksApp","to":"TasksEditorProvider","label":"postMessage","style":"dashed"},{"from":"TasksEditorProvider","to":"lib/","label":"uses"},{"from":"TasksEditorProvider","to":".tasks.md","label":"reads/writes","style":"dashed"},{"from":"LM Tools","to":".tasks.md","label":"reads/writes","style":"dashed"},{"from":"User","to":"TasksApp","label":"interacts"}],"groupIndex":[{"group":"Extension Host","members":["extension.ts","DiagramEditorProvider","DiagramService","LM Tools","lib/","TasksEditorProvider"]},{"group":"Webview / React","members":["useGraphState","CanvasPanel","Toolbar","DiagramGroupNode","TasksApp"]},{"group":"File System","members":[".diagram.svg",".tasks.md"]}],"usage":"When the DiagramFlow VS Code extension is installed, use the diagramflow_getDiagram / diagramflow_addNodes / diagramflow_addEdges / diagramflow_updateNodes / diagramflow_updateEdges / diagramflow_removeNodes / diagramflow_removeEdges / diagramflow_addGroups / diagramflow_updateGroups / diagramflow_removeGroups tools to read and modify this diagram programmatically."},"textElements":[]}</diagramflow:source></metadata>
<rect x="-20" y="-460" width="1130" height="1038" fill="#1e1e1e"/>
<defs>
  <marker id="arrow-normal" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#888"/></marker>
  <marker id="arrow-open" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polyline points="0 0, 10 3.5, 0 7" fill="none" stroke="#888" stroke-width="1.5"/></marker>
</defs>
<g id="edge-layer"><line x1="500" y1="-396" x2="770" y2="-396" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="635" y="-402" text-anchor="middle" fill="#aaa" font-size="11">registers</text>
<line x1="500" y1="-396" x2="990" y2="-396" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="745" y="-402" text-anchor="middle" fill="#aaa" font-size="11">creates</text>
<line x1="500" y1="-396" x2="405" y2="-256" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="452.5" y="-332" text-anchor="middle" fill="#aaa" font-size="11">registers</text>
<line x1="770" y1="-396" x2="990" y2="-396" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="880" y="-402" text-anchor="middle" fill="#aaa" font-size="11">uses</text>
<line x1="990" y1="-396" x2="990" y2="-306" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="990" y="-357" text-anchor="middle" fill="#aaa" font-size="11">uses</text>
<line x1="990" y1="-396" x2="900" y2="164" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-normal)"/><text x="945" y="-122" text-anchor="middle" fill="#aaa" font-size="11">reads/writes</text>
<line x1="405" y1="-256" x2="990" y2="-396" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="697.5" y="-332" text-anchor="middle" fill="#aaa" font-size="11">invokes</text>
<line x1="100" y1="-316" x2="405" y2="-256" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-open)"/><text x="252.5" y="-292" text-anchor="middle" fill="#aaa" font-size="11">invokes tools</text>
<line x1="770" y1="-396" x2="140" y2="364" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="455" y="-22" text-anchor="middle" fill="#aaa" font-size="11">renders webview</text>
<line x1="140" y1="364" x2="770" y2="-396" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-normal)"/><text x="455" y="-22" text-anchor="middle" fill="#aaa" font-size="11">postMessage</text>
<line x1="500" y1="364" x2="140" y2="364" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="320" y="358" text-anchor="middle" fill="#aaa" font-size="11">triggers</text>
<line x1="330" y1="364" x2="140" y2="364" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="235" y="358" text-anchor="middle" fill="#aaa" font-size="11">uses</text>
<line x1="110" y1="514" x2="500" y2="364" stroke="#888" stroke-width="2" marker-end="url(#arrow-open)"/><text x="305" y="433" text-anchor="middle" fill="#aaa" font-size="11">interacts</text>
<line x1="690" y1="364" x2="140" y2="364" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="415" y="358" text-anchor="middle" fill="#aaa" font-size="11">collapse/expand cb</text>
<line x1="500" y1="-396" x2="560" y2="-276" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="530" y="-342" text-anchor="middle" fill="#aaa" font-size="11">registers</text>
<line x1="560" y1="-276" x2="380" y2="84" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="470" y="-102" text-anchor="middle" fill="#aaa" font-size="11">renders webview</text>
<line x1="380" y1="84" x2="560" y2="-276" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-normal)"/><text x="470" y="-102" text-anchor="middle" fill="#aaa" font-size="11">postMessage</text>
<line x1="560" y1="-276" x2="990" y2="-306" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="775" y="-297" text-anchor="middle" fill="#aaa" font-size="11">uses</text>
<line x1="560" y1="-276" x2="620" y2="84" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-normal)"/><text x="590" y="-102" text-anchor="middle" fill="#aaa" font-size="11">reads/writes</text>
<line x1="405" y1="-256" x2="620" y2="84" stroke="#888" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrow-normal)"/><text x="512.5" y="-92" text-anchor="middle" fill="#aaa" font-size="11">reads/writes</text>
<line x1="110" y1="514" x2="380" y2="84" stroke="#888" stroke-width="2" marker-end="url(#arrow-normal)"/><text x="245" y="293" text-anchor="middle" fill="#aaa" font-size="11">interacts</text></g>
<g id="node-layer"><g transform="translate(420,-420)"><rect width="160" height="48" rx="12" ry="12" fill="#1e3a5f" stroke="#4a90d9" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90c4f9" font-size="13">extension.ts</text></g>
<g transform="translate(670,-420)"><rect width="200" height="48" rx="12" ry="12" fill="#1e3a5f" stroke="#4a90d9" stroke-width="2"/><text x="100" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90c4f9" font-size="13">DiagramEditorProvider</text></g>
<g transform="translate(910,-420)"><rect width="160" height="48" rx="12" ry="12" fill="#1e3a5f" stroke="#4a90d9" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90c4f9" font-size="13">DiagramService</text></g>
<g transform="translate(340,-280)"><rect width="130" height="48" rx="12" ry="12" fill="#2a1a3a" stroke="#8040c8" stroke-width="2"/><text x="65" y="25" text-anchor="middle" dominant-baseline="middle" fill="#c090f0" font-size="13">LM Tools</text></g>
<g transform="translate(910,-330)"><rect width="160" height="48" rx="10" ry="10" fill="#2d2d2d" stroke="#555" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#ccc" font-size="13">lib/</text></g>
<g transform="translate(830,140)"><rect width="140" height="48" rx="10" ry="10" fill="#333" stroke="#666" stroke-width="2"/><text x="70" y="25" text-anchor="middle" dominant-baseline="middle" fill="#aaa" font-size="13">.diagram.svg</text></g>
<g transform="translate(60,340)"><rect width="160" height="48" rx="12" ry="12" fill="#1a3a1a" stroke="#4a9a4a" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90d490" font-size="13">useGraphState</text></g>
<g transform="translate(260,340)"><rect width="140" height="48" rx="12" ry="12" fill="#1a3a1a" stroke="#4a9a4a" stroke-width="2"/><text x="70" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90d490" font-size="13">CanvasPanel</text></g>
<g transform="translate(440,340)"><rect width="120" height="48" rx="12" ry="12" fill="#1a3a1a" stroke="#4a9a4a" stroke-width="2"/><text x="60" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90d490" font-size="13">Toolbar</text></g>
<g transform="translate(600,340)"><rect width="180" height="48" rx="12" ry="12" fill="#1a3a1a" stroke="#4a9a4a" stroke-width="2"/><text x="90" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90d490" font-size="13">DiagramGroupNode</text></g>
<g transform="translate(60,490)"><rect width="100" height="48" rx="12" ry="12" fill="#3a3a1a" stroke="#c8a840" stroke-width="2"/><text x="50" y="25" text-anchor="middle" dominant-baseline="middle" fill="#f0d490" font-size="13">User</text></g>
<g transform="translate(20,-340)"><rect width="160" height="48" rx="12" ry="12" fill="#2a1a3a" stroke="#8040c8" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#c090f0" font-size="13">GitHub Copilot</text></g>
<g transform="translate(480,-300)"><rect width="160" height="48" rx="12" ry="12" fill="#1e3a5f" stroke="#4a90d9" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90c4f9" font-size="13">TasksEditorProvider</text></g>
<g transform="translate(300,60)"><rect width="160" height="48" rx="12" ry="12" fill="#1a3a1a" stroke="#4a9a4a" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#90d490" font-size="13">TasksApp</text></g>
<g transform="translate(540,60)"><rect width="160" height="48" rx="10" ry="10" fill="#333" stroke="#666" stroke-width="2"/><text x="80" y="25" text-anchor="middle" dominant-baseline="middle" fill="#aaa" font-size="13">.tasks.md</text></g></g>
<g id="text-layer"></g>
<g id="image-layer"></g>
</svg>